<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login | Sentiment AI Platform</title>
  <meta name="description"
    content="Sign in to the Sentiment AI emotion detection platform. Real-time facial emotion detection using YOLOv8 and CNN." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    rel="stylesheet" />
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --primary: #1978e5;
      --accent: #7f13ec;
      --bg: #111821;
      --card: rgba(17, 24, 39, 0.75);
      --border: rgba(255, 255, 255, 0.07);
      --text: #e2e8f0;
      --text-muted: #64748b;
      --red: #ef4444;
      --green: #22c55e;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      overflow: hidden;
    }

    /* Background gradient */
    body::before {
      content: '';
      position: fixed;
      top: -30%;
      left: -20%;
      width: 80%;
      height: 80%;
      background: radial-gradient(circle, rgba(127, 19, 236, 0.12) 0%, transparent 60%);
      pointer-events: none;
    }

    body::after {
      content: '';
      position: fixed;
      bottom: -30%;
      right: -20%;
      width: 70%;
      height: 70%;
      background: radial-gradient(circle, rgba(25, 120, 229, 0.1) 0%, transparent 55%);
      pointer-events: none;
    }

    .auth-container {
      width: 100%;
      max-width: 440px;
      position: relative;
      z-index: 1;
    }

    /* Brand */
    .brand {
      text-align: center;
      margin-bottom: 32px;
    }

    .brand-icon {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .brand-icon span {
      font-size: 32px;
      color: #fff;
    }

    .brand-title {
      font-size: 22px;
      font-weight: 800;
      letter-spacing: -0.03em;
    }

    .brand-tagline {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Card */
    .auth-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      backdrop-filter: blur(20px);
    }

    .auth-header {
      text-align: center;
      margin-bottom: 28px;
    }

    .auth-header h1 {
      font-size: 24px;
      font-weight: 700;
    }

    .auth-header p {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    /* Form */
    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #94a3b8;
      margin-bottom: 6px;
    }

    .input-wrap {
      position: relative;
    }

    .input-wrap input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .input-wrap input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(127, 19, 236, 0.15);
    }

    .input-wrap input::placeholder {
      color: #475569;
    }

    .toggle-pw {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 20px;
      display: flex;
    }

    /* Error */
    .error-banner {
      background: rgba(239, 68, 68, 0.12);
      border: 1px solid rgba(239, 68, 68, 0.25);
      color: #fca5a5;
      font-size: 13px;
      padding: 10px 14px;
      border-radius: 8px;
      margin-bottom: 16px;
      display: none;
      align-items: center;
      gap: 8px;
    }

    .error-banner.show {
      display: flex;
    }

    .error-banner span {
      font-size: 18px;
    }

    /* Button */
    .btn-auth {
      width: 100%;
      padding: 13px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: #fff;
      font-family: inherit;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: opacity 0.2s, transform 0.1s;
      margin-top: 4px;
    }

    .btn-auth:hover {
      opacity: 0.92;
    }

    .btn-auth:active {
      transform: scale(0.98);
    }

    .btn-auth:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      display: none;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Links */
    .auth-footer {
      text-align: center;
      margin-top: 24px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .auth-footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }

    .auth-footer a:hover {
      text-decoration: underline;
    }

    /* Panel switch */
    .auth-panel {
      display: none;
    }

    .auth-panel.active {
      display: block;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <div class="auth-container">

    <!-- Brand -->
    <div class="brand">
      <div class="brand-icon">
        <span class="material-symbols-outlined">sentiment_very_satisfied</span>
      </div>
      <div class="brand-title">Sentiment AI</div>
      <div class="brand-tagline">Real-time emotion detection platform</div>
    </div>

    <!-- Login Panel -->
    <div class="auth-panel active" id="loginPanel">
      <div class="auth-card">
        <div class="auth-header">
          <h1>Welcome back!</h1>
          <p>Sign in to your account</p>
        </div>

        <div class="error-banner" id="loginError">
          <span class="material-symbols-outlined">error</span>
          <span id="loginErrorText">Invalid credentials</span>
        </div>

        <form onsubmit="handleLogin(event)">
          <div class="form-group">
            <label>Email</label>
            <div class="input-wrap">
              <input type="email" id="loginEmail" placeholder="Enter your email" required />
            </div>
          </div>
          <div class="form-group">
            <label>Password</label>
            <div class="input-wrap">
              <input type="password" id="loginPassword" placeholder="Enter your password" required />
              <button type="button" class="toggle-pw" onclick="togglePw('loginPassword', this)">
                <span class="material-symbols-outlined">visibility</span>
              </button>
            </div>
          </div>
          <button type="submit" class="btn-auth" id="loginBtn">
            <span id="loginBtnText">Sign In</span>
            <div class="spinner" id="loginSpinner"></div>
          </button>
        </form>
      </div>
      <div class="auth-footer">
        Don't have an account?
        <a href="#" onclick="showPanel('registerPanel')">Create account</a>
      </div>
    </div>

    <!-- Register Panel -->
    <div class="auth-panel" id="registerPanel">
      <div class="auth-card">
        <div class="auth-header">
          <h1>Create Account</h1>
          <p>Get started with Sentiment AI</p>
        </div>

        <div class="error-banner" id="registerError">
          <span class="material-symbols-outlined">error</span>
          <span id="registerErrorText">Registration failed</span>
        </div>

        <form onsubmit="handleRegister(event)">
          <div class="form-group">
            <label>Full Name</label>
            <div class="input-wrap">
              <input type="text" id="regName" placeholder="Your full name" required />
            </div>
          </div>
          <div class="form-group">
            <label>Email</label>
            <div class="input-wrap">
              <input type="email" id="regEmail" placeholder="Enter your email" required />
            </div>
          </div>
          <div class="form-group">
            <label>Password</label>
            <div class="input-wrap">
              <input type="password" id="regPassword" placeholder="Create a password (min 6 chars)" required
                minlength="6" />
              <button type="button" class="toggle-pw" onclick="togglePw('regPassword', this)">
                <span class="material-symbols-outlined">visibility</span>
              </button>
            </div>
          </div>
          <div class="form-group">
            <label>Confirm Password</label>
            <div class="input-wrap">
              <input type="password" id="regConfirm" placeholder="Confirm your password" required />
            </div>
          </div>
          <button type="submit" class="btn-auth" id="registerBtn">
            <span id="registerBtnText">Create Account</span>
            <div class="spinner" id="registerSpinner"></div>
          </button>
        </form>
      </div>
      <div class="auth-footer">
        Already have an account?
        <a href="#" onclick="showPanel('loginPanel')">Sign in</a>
      </div>
    </div>

  </div>

  <script type="module">
    import { loginUser, registerUser, getCurrentUser } from './js/firebase-config.js';

    // If already logged in, redirect to dashboard
    const existing = getCurrentUser();
    if (existing) window.location.href = 'dashboard.html';

    // ── Panel switching ──────────────────────────────────
    window.showPanel = function (id) {
      document.querySelectorAll('.auth-panel').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      // Hide errors
      document.getElementById('loginError').classList.remove('show');
      document.getElementById('registerError').classList.remove('show');
    };

    // ── Toggle password visibility ───────────────────────
    window.togglePw = function (inputId, btn) {
      const input = document.getElementById(inputId);
      const icon = btn.querySelector('.material-symbols-outlined');
      if (input.type === 'password') {
        input.type = 'text';
        icon.textContent = 'visibility_off';
      } else {
        input.type = 'password';
        icon.textContent = 'visibility';
      }
    };

    // ── Helpers ──────────────────────────────────────────
    function showLoginError(msg) {
      document.getElementById('loginErrorText').textContent = msg;
      document.getElementById('loginError').classList.add('show');
    }
    function showRegisterError(msg) {
      document.getElementById('registerErrorText').textContent = msg;
      document.getElementById('registerError').classList.add('show');
    }
    function setLoading(btnId, textId, spinnerId, loading) {
      const btn = document.getElementById(btnId);
      const text = document.getElementById(textId);
      const spinner = document.getElementById(spinnerId);
      btn.disabled = loading;
      spinner.style.display = loading ? 'inline-block' : 'none';
      if (loading) text.textContent = btnId === 'loginBtn' ? 'Signing in...' : 'Creating account...';
    }
    function resetBtn(btnId, textId, spinnerId, label) {
      const btn = document.getElementById(btnId);
      btn.disabled = false;
      document.getElementById(spinnerId).style.display = 'none';
      document.getElementById(textId).textContent = label;
    }

    function firebaseErrorMsg(code) {
      const map = {
        'auth/email-already-in-use': 'This email is already registered. Try signing in.',
        'auth/invalid-email': 'Please enter a valid email address.',
        'auth/weak-password': 'Password must be at least 6 characters.',
        'auth/user-not-found': 'No account found with this email.',
        'auth/wrong-password': 'Incorrect password. Please try again.',
        'auth/invalid-credential': 'Invalid email or password.',
        'auth/too-many-requests': 'Too many attempts. Please wait and try again.',
        'auth/operation-not-allowed': 'Email/Password sign-in is not enabled. Contact admin.',
      };
      return map[code] || 'Authentication failed. Please try again.';
    }

    // ── Login ────────────────────────────────────────────
    window.handleLogin = async function (e) {
      e.preventDefault();
      document.getElementById('loginError').classList.remove('show');
      const email = document.getElementById('loginEmail').value.trim();
      const pass = document.getElementById('loginPassword').value;
      if (!email || !pass) { showLoginError('Please fill in all fields.'); return; }

      setLoading('loginBtn', 'loginBtnText', 'loginSpinner', true);
      try {
        const user = await loginUser(email, pass);
        sessionStorage.setItem('user_email', user.email);
        sessionStorage.setItem('user_name', user.email.split('@')[0]);
        sessionStorage.setItem('user_uid', user.uid);
        window.location.href = 'dashboard.html';
      } catch (err) {
        showLoginError(firebaseErrorMsg(err.code));
        resetBtn('loginBtn', 'loginBtnText', 'loginSpinner', 'Sign In');
      }
    };

    // ── Register ─────────────────────────────────────────
    window.handleRegister = async function (e) {
      e.preventDefault();
      document.getElementById('registerError').classList.remove('show');
      const name = document.getElementById('regName').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const pass = document.getElementById('regPassword').value;
      const confirm = document.getElementById('regConfirm').value;

      if (!name || !email || !pass) { showRegisterError('Please fill in all fields.'); return; }
      if (pass !== confirm) { showRegisterError('Passwords do not match.'); return; }
      if (pass.length < 6) { showRegisterError('Password must be at least 6 characters.'); return; }

      setLoading('registerBtn', 'registerBtnText', 'registerSpinner', true);
      try {
        const user = await registerUser(email, pass);
        sessionStorage.setItem('user_email', user.email);
        sessionStorage.setItem('user_name', name.split(' ')[0]);
        sessionStorage.setItem('user_uid', user.uid);
        window.location.href = 'dashboard.html';
      } catch (err) {
        showRegisterError(firebaseErrorMsg(err.code));
        resetBtn('registerBtn', 'registerBtnText', 'registerSpinner', 'Create Account');
      }
    };
  </script>
</body>

</html>